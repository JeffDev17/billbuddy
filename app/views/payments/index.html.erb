<div class="mb-8">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Pagamentos</h2>
    <%= link_to "Novo Pagamento", new_payment_path, class: "px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded dark:bg-indigo-700 dark:hover:bg-indigo-800" %>
  </div>

  <div class="bg-white dark:bg-dark-bg-secondary p-6 rounded-lg shadow mb-6">
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Filtros</h3>

    <%= form_with(url: payments_path, method: :get, local: true, class: "flex flex-wrap gap-4") do |form| %>
      <div class="flex-1">
        <%= form.label :customer_id, "Cliente", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
        <%= form.collection_select :customer_id, current_user.customers.order(name: :asc), :id, :name, { include_blank: "Todos" }, class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 bg-white dark:bg-dark-bg-tertiary text-gray-900 dark:text-gray-100" %>
      </div>

      <div class="flex-1">
        <%= form.label :payment_type, "Tipo", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
        <%= form.select :payment_type, [["Todos", ""], ["Crédito", "credit"], ["Assinatura", "subscription"]], { selected: params[:payment_type] }, class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 bg-white dark:bg-dark-bg-tertiary text-gray-900 dark:text-gray-100" %>
      </div>

      <div class="flex-1">
        <%= form.label :start_date, "Data Inicial", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
        <%= form.date_field :start_date, value: params[:start_date], class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 bg-white dark:bg-dark-bg-tertiary text-gray-900 dark:text-gray-100" %>
      </div>

      <div class="flex-1">
        <%= form.label :end_date, "Data Final", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
        <%= form.date_field :end_date, value: params[:end_date], class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 bg-white dark:bg-dark-bg-tertiary text-gray-900 dark:text-gray-100" %>
      </div>

      <div class="flex items-end">
        <%= form.submit "Filtrar", class: "px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded dark:bg-indigo-700 dark:hover:bg-indigo-800" %>
      </div>
    <% end %>
  </div>

  <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-dark-bg-tertiary">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Cliente</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tipo</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Valor</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Detalhes</th>
      </tr>
      </thead>
      <tbody class="bg-white dark:bg-dark-bg-secondary divide-y divide-gray-200 dark:divide-gray-700">
      <% @payments.each do |payment| %>
        <tr class="hover:bg-gray-50 dark:hover:bg-dark-bg-tertiary">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100"><%= payment.payment_date.strftime("%d/%m/%Y") %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <%= link_to payment.customer.name, customer_path(payment.customer), class: "text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300" %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <% case payment.payment_type %>
            <% when 'credit' %>
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Crédito</span>
            <% when 'subscription' %>
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">Assinatura</span>
            <% end %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-indigo-600 dark:text-indigo-400">R$ <%= sprintf("%.2f", payment.amount) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300"><%= payment.notes %></td>
        </tr>
      <% end %>
      </tbody>
    </table>

    <% if @payments.empty? %>
      <div class="px-6 py-4 text-center text-gray-700 dark:text-gray-300">
        Nenhum pagamento encontrado.
      </div>
    <% end %>
  </div>
</div>