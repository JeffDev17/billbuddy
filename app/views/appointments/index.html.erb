<div class="container mx-auto px-4" data-controller="appointments">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Compromissos</h1>
    <div class="flex space-x-3">
      <%= link_to manage_auto_generation_appointments_path,
          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-purple-400" do %>
        üß† Gera√ß√£o Inteligente
      <% end %>
      <%= link_to new_appointment_path, 
          class: "inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400" do %>
        + Novo Compromisso
      <% end %>
    </div>
  </div>

  <!-- Sync Controls Section -->
  <% if current_user.google_calendar_authorized? %>
    <div class="mb-6">
      <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">üîÑ Sincroniza√ß√£o do Google Calendar</h3>
            <p class="text-xs text-blue-600 dark:text-blue-300 mt-1">
              Sincronize compromissos n√£o sincronizados com o Google Calendar
            </p>
          </div>
          <div class="flex space-x-3">
            <%= link_to review_sync_appointments_path(scope: 'upcoming'),
                class: "bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm" do %>
              üìÖ Revisar Pr√≥ximos (1 m√™s)
            <% end %>
            <%= link_to review_sync_appointments_path(scope: 'all'),
                class: "bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded text-sm" do %>
              üîÑ Revisar Todos
            <% end %>
            
            <!-- Quick sync options (smaller buttons) -->
            <div class="border-l border-blue-300 pl-3 ml-3 flex space-x-2">
              <%= link_to sync_upcoming_appointments_appointments_path, method: :post,
                  class: "bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs",
                  data: { confirm: "Sincronizar diretamente os pr√≥ximos compromissos (1 m√™s)?" },
                  title: "Sincroniza√ß√£o direta sem revis√£o" do %>
                ‚ö° Direto
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Month Navigation Section -->
  <div class="mb-6">
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 flex items-center">
          üìÖ Navega√ß√£o por M√™s
        </h3>
        <div class="flex items-center space-x-2">
          <% current_date = params[:month].present? && params[:year].present? ? Date.new(params[:year].to_i, params[:month].to_i, 1) : Date.current %>
          <% prev_month = current_date.prev_month %>
          <% next_month = current_date.next_month %>
          
          <%= link_to appointments_path(month: prev_month.month, year: prev_month.year, **@current_filters.except(:month, :year)),
              class: "inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600" do %>
            ‚Üê <%= prev_month.strftime('%b %Y') %>
          <% end %>
          
          <span class="px-4 py-2 text-lg font-semibold text-gray-900 dark:text-gray-100">
            <%= current_date.strftime('%B %Y') %>
          </span>
          
          <%= link_to appointments_path(month: next_month.month, year: next_month.year, **@current_filters.except(:month, :year)),
              class: "inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600" do %>
            <%= next_month.strftime('%b %Y') %> ‚Üí
          <% end %>
        </div>
      </div>
      
      <!-- Quick Month Jumps -->
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2">
        <%= link_to "Este M√™s", appointments_path(month: Date.current.month, year: Date.current.year), 
            class: "px-3 py-2 text-sm rounded-md border #{current_date.month == Date.current.month && current_date.year == Date.current.year ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
        
        <% last_month = Date.current.prev_month %>
        <%= link_to "M√™s Passado", appointments_path(month: last_month.month, year: last_month.year), 
            class: "px-3 py-2 text-sm rounded-md border #{current_date.month == last_month.month && current_date.year == last_month.year ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
        
        <% next_month_jump = Date.current.next_month %>
        <%= link_to "Pr√≥ximo M√™s", appointments_path(month: next_month_jump.month, year: next_month_jump.year), 
            class: "px-3 py-2 text-sm rounded-md border #{current_date.month == next_month_jump.month && current_date.year == next_month_jump.year ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
        
        <%= link_to "Todos", appointments_path, 
            class: "px-3 py-2 text-sm rounded-md border #{!params[:month] && !params[:year] ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="mb-6">
    <div class="bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700">
      <div class="p-4 border-b border-gray-200 dark:border-slate-700">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 flex items-center">
          üîç Filtros de Busca
        </h3>
      </div>
      
      <div class="p-4">
        <%= form_with url: appointments_path, method: :get, local: true, data: { controller: "appointment-filters", appointment_filters_target: "form" }, class: "space-y-4" do |form| %>
          
          <!-- Hidden month/year fields to preserve navigation state -->
          <%= form.hidden_field :month, value: params[:month] if params[:month].present? %>
          <%= form.hidden_field :year, value: params[:year] if params[:year].present? %>
          
          <!-- Sort Order Controls -->
          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Ordena√ß√£o:</span>
              <div class="flex space-x-2">
                <% month_year_params = { month: params[:month], year: params[:year] }.compact %>
                <%= link_to appointments_path(sort_order: 'scheduled_first', **@current_filters.except(:sort_order), **month_year_params), 
                    class: "text-xs px-2 py-1 rounded-md border #{@current_filters[:sort_order] == 'scheduled_first' || @current_filters[:sort_order].blank? ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}" do %>
                  üìã Agendados Primeiro
                <% end %>
                <%= link_to appointments_path(sort_order: 'earliest_first', **@current_filters.except(:sort_order), **month_year_params), 
                    class: "text-xs px-2 py-1 rounded-md border #{@current_filters[:sort_order] == 'earliest_first' ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}" do %>
                  ‚¨ÜÔ∏è Antigos ‚Üí Recentes
                <% end %>
                <%= link_to appointments_path(sort_order: 'latest_first', **@current_filters.except(:sort_order), **month_year_params), 
                    class: "text-xs px-2 py-1 rounded-md border #{@current_filters[:sort_order] == 'latest_first' ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}" do %>
                  ‚¨áÔ∏è Recentes ‚Üí Antigos
                <% end %>
              </div>
            </div>
          </div>
          
          <!-- Quick Date Filters within current month -->
          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Filtros R√°pidos:</span>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2">
            <%= link_to "Hoje", appointments_path(start_date: Date.current, end_date: Date.current, **month_year_params), 
                class: "px-3 py-2 text-sm rounded-md border #{@current_filters[:start_date] == Date.current.to_s && @current_filters[:end_date] == Date.current.to_s ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
            
            <%= link_to "Esta Semana", appointments_path(start_date: Date.current.beginning_of_week, end_date: Date.current.end_of_week, **month_year_params), 
                class: "px-3 py-2 text-sm rounded-md border #{@current_filters[:start_date] == Date.current.beginning_of_week.to_s && @current_filters[:end_date] == Date.current.end_of_week.to_s ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
            
            <%= link_to "Pr√≥ximos 7 dias", appointments_path(start_date: Date.current, end_date: Date.current + 7.days, **month_year_params), 
                class: "px-3 py-2 text-sm rounded-md border #{@current_filters[:start_date] == Date.current.to_s && @current_filters[:end_date] == (Date.current + 7.days).to_s ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
            
            <%= link_to "Pr√≥ximos 30 dias", appointments_path(start_date: Date.current, end_date: Date.current + 30.days, **month_year_params), 
                class: "px-3 py-2 text-sm rounded-md border #{@current_filters[:start_date] == Date.current.to_s && @current_filters[:end_date] == (Date.current + 30.days).to_s ? 'bg-indigo-100 dark:bg-indigo-900 border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300' : 'border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700'}" %>
            
            <%= link_to "Limpar Filtros", appointments_path(**month_year_params), 
                class: "px-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400" %>
            </div>
          </div>

                     <!-- Search Bar -->
          <div class="mb-4">
            <%= form.text_field :search, 
                placeholder: "üîç Buscar por nome do cliente ou notas...",
                value: @current_filters[:search],
                class: "w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100 text-sm",
                data: { appointment_filters_target: "searchField" } %>
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2 mb-4 text-xs">
            <div class="bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-blue-700 dark:text-blue-300"><%= @filter_stats[:total] %></div>
              <div class="text-blue-600 dark:text-blue-400">Total</div>
            </div>
            <div class="bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-yellow-700 dark:text-yellow-300"><%= @filter_stats[:scheduled] %></div>
              <div class="text-yellow-600 dark:text-yellow-400">Agendados</div>
            </div>
            <div class="bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-green-700 dark:text-green-300"><%= @filter_stats[:completed] %></div>
              <div class="text-green-600 dark:text-green-400">Conclu√≠dos</div>
            </div>
            <div class="bg-red-50 dark:bg-red-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-red-700 dark:text-red-300"><%= @filter_stats[:cancelled] %></div>
              <div class="text-red-600 dark:text-red-400">Cancelados</div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700 px-2 py-1 rounded text-center">
              <div class="font-semibold text-gray-700 dark:text-gray-300"><%= @filter_stats[:no_show] %></div>
              <div class="text-gray-600 dark:text-gray-400">N√£o Compareceu</div>
            </div>
            <div class="bg-indigo-50 dark:bg-indigo-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-indigo-700 dark:text-indigo-300"><%= @filter_stats[:today] %></div>
              <div class="text-indigo-600 dark:text-indigo-400">Hoje</div>
            </div>
            <div class="bg-purple-50 dark:bg-purple-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-purple-700 dark:text-purple-300"><%= @filter_stats[:this_week] %></div>
              <div class="text-purple-600 dark:text-purple-400">Esta Semana</div>
            </div>
            <div class="bg-teal-50 dark:bg-teal-900/20 px-2 py-1 rounded text-center">
              <div class="font-semibold text-teal-700 dark:text-teal-300"><%= @filter_stats[:future] %></div>
              <div class="text-teal-600 dark:text-teal-400">Futuros</div>
            </div>
          </div>

          <!-- Detailed Filters -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            
            <!-- Status Filter -->
            <div>
              <%= form.label :status, "Status", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
              <%= form.select :status, 
                  options_for_select([
                    ['Todos os status', ''],
                    ['‚è≥ Agendado', 'scheduled'],
                    ['‚úÖ Conclu√≠do', 'completed'],
                    ['‚ùå Cancelado', 'cancelled'],
                    ['üëª N√£o compareceu', 'no_show']
                  ], @current_filters[:status]),
                  {},
                  { class: "w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100", 
                    data: { appointment_filters_target: "statusSelect" } } %>
            </div>

            <!-- Customer Filter -->
            <div>
              <%= form.label :customer_id, "Cliente", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
              <%= form.select :customer_id, 
                  options_from_collection_for_select(@customers_for_filter, :id, :name, @current_filters[:customer_id]),
                  { prompt: "Todos os clientes" },
                  { class: "w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100", 
                    data: { appointment_filters_target: "customerSelect" } } %>
            </div>

            <!-- Start Date -->
            <div>
              <%= form.label :start_date, "Data Inicial", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
              <%= form.date_field :start_date, 
                  value: @current_filters[:start_date],
                  class: "w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100",
                  data: { appointment_filters_target: "startDate" } %>
            </div>

            <!-- End Date -->
            <div>
              <%= form.label :end_date, "Data Final", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
              <%= form.date_field :end_date, 
                  value: @current_filters[:end_date],
                  class: "w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100",
                  data: { appointment_filters_target: "endDate" } %>
            </div>

            <!-- Sort Order -->
            <div>
              <%= form.label :sort_order, "Ordenar por", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
              <%= form.select :sort_order, 
                  options_for_select([
                    ['üìã Agendados Primeiro (Recomendado)', 'scheduled_first'],
                    ['üìÖ Mais Antigos Primeiro', 'earliest_first'],
                    ['üìÖ Mais Recentes Primeiro', 'latest_first'],
                    ['üë§ Nome do Cliente', 'customer_name'],
                    ['üìä Status', 'status']
                  ], @current_filters[:sort_order] || 'scheduled_first'),
                  {},
                  { class: "w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100", 
                    data: { appointment_filters_target: "sortSelect" } } %>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="flex space-x-3">
              <%= form.submit "üîç Aplicar Filtros", 
                  class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-purple-400",
                  data: { appointment_filters_target: "submitButton" } %>
              
              <%= link_to "üóëÔ∏è Limpar Filtros", appointments_path, 
                  class: "inline-flex items-center px-4 py-2 border border-gray-300 dark:border-slate-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-purple-50 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-purple-400" %>
            </div>
            
            <div class="flex items-center space-x-4">
              <div class="text-sm text-gray-500 dark:text-gray-400">
                <%= pluralize(@appointments.count, 'compromisso', 'compromissos') %> encontrado<%= @appointments.count == 1 ? '' : 's' %>
              </div>
              
              <!-- Active Filters Display -->
              <% if @current_filters.values.any?(&:present?) %>
                <div class="flex items-center space-x-2 text-xs">
                  <span class="text-gray-400">Filtros ativos:</span>
                  <% @current_filters.each do |key, value| %>
                    <% if value.present? %>
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300">
                        <% case key %>
                        <% when :status %>
                          Status: <%= {
                            'scheduled' => '‚è≥ Agendado',
                            'completed' => '‚úÖ Conclu√≠do', 
                            'cancelled' => '‚ùå Cancelado',
                            'no_show' => 'üëª N√£o compareceu'
                          }[value] || value %>
                        <% when :customer_id %>
                          Cliente: <%= @customers_for_filter.find { |c| c.id.to_s == value.to_s }&.name || value %>
                        <% when :start_date %>
                          De: <%= begin; format_brazilian_date_with_weekday_short(Date.parse(value)); rescue; value; end %>
                        <% when :end_date %>
                          At√©: <%= begin; format_brazilian_date_with_weekday_short(Date.parse(value)); rescue; value; end %>
                                                 <% when :search %>
                           üîç "<%= value %>"
                         <% when :sort_order %>
                           <% sort_labels = {
                             'scheduled_first' => 'üìã Agendados Primeiro',
                             'latest_first' => 'üìÖ Mais Recentes Primeiro',
                             'earliest_first' => 'üìÖ Mais Antigos Primeiro', 
                             'customer_name' => 'üë§ Nome do Cliente',
                             'status' => 'üìä Status'
                           } %>
                           <%= sort_labels[value] || value %>
                         <% end %>
                      </span>
                    <% end %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Customer Filter for Bulk Delete - Collapsible Section -->
  <div class="mb-6">
    <button type="button" 
            onclick="document.getElementById('bulk-delete-section').classList.toggle('hidden')"
            class="w-full flex items-center justify-between p-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-slate-700 rounded-lg hover:bg-purple-50 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
      <span>üóëÔ∏è Op√ß√µes Avan√ßadas - Deletar Compromissos por Cliente</span>
      <svg class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>
    
    <div id="bulk-delete-section" class="hidden mt-2 bg-gray-50 dark:bg-slate-800 rounded-lg p-4" data-controller="bulk-operations" data-bulk-operations-type-value="delete">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">
        üóëÔ∏è Deletar Compromissos por Cliente
      </h3>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        Selecione um cliente para deletar todos os seus compromissos. Esta a√ß√£o n√£o pode ser desfeita.
      </p>
      <%= form_with url: "", method: :get, local: true, class: "space-y-4" do |form| %>
        <div class="flex flex-wrap items-end gap-4">
          <div class="min-w-0 flex-1">
            <label for="customer_select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Selecionar Cliente
            </label>
            <select id="customer_select" 
                    data-bulk-operations-target="customerSelect"
                    data-action="change->bulk-operations#updateDeleteButton"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100">
              <option value="">Selecione um cliente...</option>
              <% current_user.customers.joins(:appointments).distinct.order(:name).each do |customer| %>
                <option value="<%= customer.id %>" 
                        data-count="<%= customer.appointments.count %>"
                        data-future-count="<%= customer.appointments.future.count %>">
                  <%= customer.name %> (<%= customer.appointments.count %> compromissos, <%= customer.appointments.future.count %> futuros)
                </option>
              <% end %>
            </select>
          </div>
          <div>
            <button type="button" 
                    data-bulk-operations-target="deleteButton"
                    data-action="click->bulk-operations#confirmDelete"
                    disabled
                    class="disabled:opacity-50 disabled:cursor-not-allowed px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
              Deletar Todos
            </button>
          </div>
        </div>
        
        <div class="flex items-center">
          <input type="checkbox" 
                 id="future_only_checkbox" 
                 data-bulk-operations-target="futureOnlyCheckbox"
                 data-action="change->bulk-operations#updateDeleteButton"
                 class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded">
          <label for="future_only_checkbox" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
            üöÄ Deletar apenas compromissos futuros (a partir de agora)
          </label>
        </div>
        
        <div class="text-xs text-gray-500 dark:text-gray-400 bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded">
          üí° <strong>Dica:</strong> Marque a op√ß√£o acima para deletar apenas os compromissos futuros do cliente, 
          preservando o hist√≥rico de compromissos j√° realizados ou passados.
        </div>
      <% end %>
    </div>
  </div>

  <%= render "appointments_table" %>
</div>