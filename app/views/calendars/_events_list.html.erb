<%= turbo_frame_tag "events_list" do %>
  <div id="events_list">
    <% if @events.any? %>
      <div class="divide-y divide-gray-200 dark:divide-gray-700">
        <% @events.each do |event| %>
          <% if event.respond_to?(:billbuddy_event) && event.billbuddy_event %>
            <!-- BillBuddy Appointment -->
            <div class="px-6 py-4">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-medium text-indigo-600 dark:text-indigo-400">
                        <%= event.customer.name %>
                      </p>
                      <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                        <%= format_brazilian_time(event.start.date_time) %> - <%= format_brazilian_time(event.end.date_time) %>
                        (<%= event.appointment.duration %>h)
                      </p>
                      
                      <div class="mt-2">
                        <% if event.appointment.synced_to_calendar? %>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                            <% if event.appointment.part_of_recurring_series? %>
                              üîÑ S√©rie Recorrente
                            <% else %>
                              ‚úì Sincronizado
                            <% end %>
                          </span>
                        <% else %>
                          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                            ‚è≥ Pendente
                          </span>
                        <% end %>
                        
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                          üí≥ Tipo: 
                          <% if event.customer.credit? %>
                            Cr√©dito (<%= event.customer.total_remaining_hours %>h restantes)
                          <% elsif event.customer.subscription? %>
                            Assinatura
                          <% end %>
                        </p>
                        
                        <% if event.appointment.notes.present? %>
                          <p class="text-sm text-gray-600 dark:text-gray-400">
                            üìù <%= event.appointment.notes %>
                          </p>
                        <% end %>
                      </div>
                    </div>
                    
                    <div class="flex space-x-2 ml-4">
                      <% unless event.synced_to_calendar %>
                        <%= form_with url: sync_appointment_calendars_path(event.appointment.id), method: :post, local: false, class: "inline" do |form| %>
                          <%= form.submit "üîÑ", 
                              class: "text-blue-600 hover:text-blue-700 p-1 text-sm border border-blue-300 rounded hover:bg-blue-50",
                              title: "Sincronizar com Google Calendar" %>
                        <% end %>
                        
                        <!-- Sync as recurring for this customer -->
                        <%= form_with url: sync_customer_recurring_calendars_path(event.customer.id), method: :post, local: false, class: "inline" do |form| %>
                          <%= form.submit "üîÑ‚Üª", 
                              class: "text-green-600 hover:text-green-700 p-1 text-sm border border-green-300 rounded hover:bg-green-50",
                              title: "Sincronizar como s√©rie recorrente" %>
                        <% end %>
                      <% end %>
                      
                      <%= link_to edit_appointment_path(event.appointment), 
                          onclick: "preserveScrollPosition()",
                          class: "text-yellow-600 hover:text-yellow-700 p-1", 
                          title: "Editar compromisso" do %>
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                      <% end %>
                      
                      <%= link_to customer_path(event.customer), 
                          class: "text-indigo-600 hover:text-indigo-700 p-1", 
                          title: "Ver cliente" do %>
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="px-6 py-4 text-center text-gray-700 dark:text-gray-300">
        <p>Nenhum compromisso para este dia.</p>
        <p class="text-sm mt-2">
          <%= link_to "‚ûï Criar novo compromisso", new_appointment_path, 
              data: { turbo_frame: "_top" },
              class: "text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" %>
        </p>
      </div>
    <% end %>
  </div>
<% end %> 