<div class="container mx-auto px-4 py-8">
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">üìä Analytics Dashboard</h1>
      <p class="text-gray-600 dark:text-gray-400 mt-2">Insights completos sobre seus compromissos e performance</p>
    </div>
    
    <!-- Global Sensitive Data Toggle -->
    <div data-controller="sensitive-data" data-sensitive-data-type-value="global">
      <button type="button" 
              data-action="click->sensitive-data#toggle"
              class="flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
        <span data-sensitive-data-target="toggleIcon">üëÅÔ∏è‚Äçüó®Ô∏è</span>
        <span>Mostrar Valores</span>
      </button>
    </div>
  </div>

  <!-- Month/Year Selection -->
  <div class="mb-8 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div class="flex items-center space-x-4">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">üìÖ Per√≠odo de An√°lise</h3>
        <div class="text-sm text-gray-600 dark:text-gray-400">
          Visualizando: <span class="font-semibold text-gray-900 dark:text-gray-100">
            <%= Date.new(@selected_year, @selected_month, 1).strftime("%B de %Y") %>
          </span>
        </div>
      </div>
      
      <div class="flex items-center space-x-4">
        <%= form_with url: metrics_calendars_path, method: :get, class: "flex items-center space-x-3", local: true do |form| %>
          <div class="flex items-center space-x-2">
            <label class="text-sm text-gray-600 dark:text-gray-400">M√™s:</label>
            <%= form.select :month, 
                options_for_select(
                  (1..12).map { |m| [Date::MONTHNAMES[m], m] },
                  @selected_month
                ),
                {},
                { class: "rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 text-sm focus:border-indigo-500 focus:ring-indigo-500" } %>
          </div>
          
          <div class="flex items-center space-x-2">
            <label class="text-sm text-gray-600 dark:text-gray-400">Ano:</label>
            <%= form.select :year, 
                options_for_select(
                  (2020..Date.current.year + 1).map { |y| [y, y] },
                  @selected_year
                ),
                {},
                { class: "rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 text-sm focus:border-indigo-500 focus:ring-indigo-500" } %>
          </div>
          
          <%= form.submit "üìä Atualizar", 
              class: "bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2 px-4 rounded-md transition-colors duration-200" %>
        <% end %>
        
        <!-- Quick navigation buttons -->
        <div class="flex items-center space-x-1 border-l border-gray-300 dark:border-gray-600 pl-4">
          <% prev_month = @selected_date.prev_month %>
          <%= link_to metrics_calendars_path(month: prev_month.month, year: prev_month.year),
              class: "p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",
              title: "M√™s anterior" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          <% end %>
          
          <%= link_to metrics_calendars_path,
              class: "px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",
              title: "M√™s atual" do %>
            Hoje
          <% end %>
          
          <% unless @selected_date >= Date.current.beginning_of_month %>
            <% next_month = @selected_date.next_month %>
            <%= link_to metrics_calendars_path(month: next_month.month, year: next_month.year),
                class: "p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors",
                title: "Pr√≥ximo m√™s" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Authorization Check -->
  <% if @authorization_unavailable %>
    <div class="mb-8 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
              <span class="text-white text-lg">üîë</span>
            </div>
          </div>
          <div class="ml-4">
            <h3 class="text-lg font-medium text-yellow-800 dark:text-yellow-200">
              Google Calendar n√£o conectado
            </h3>
            <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
              Conecte sua conta do Google Calendar para sincronizar compromissos e obter m√©tricas completas.
            </p>
          </div>
        </div>
        <div class="flex-shrink-0">
          <%= link_to redirect_calendars_path, 
              class: "bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200" do %>
            üîó Autorizar Google Calendar
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Main Metrics Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
    <!-- Earnings -->
    <div class="bg-gradient-to-br from-green-400 to-green-600 overflow-hidden shadow-lg rounded-lg text-white">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-white bg-opacity-30 rounded-md flex items-center justify-center">
              <span class="text-white text-sm">üí∞</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-green-100 truncate">
                Ganhos do M√™s
              </dt>
              <dd class="text-2xl font-bold" data-controller="sensitive-data">
                <span data-sensitive-data-target="content">
                  R$ <%= @monthly_summary[:earnings][:completed] %>
                </span>
              </dd>
              <dt class="text-xs text-green-200 mt-1" data-controller="sensitive-data">
                <span data-sensitive-data-target="content">
                  Total + Cancelamentos: R$ <%= @monthly_summary[:earnings][:total_with_cancellations] %>
                </span>
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Average Ticket -->
    <div class="bg-gradient-to-br from-emerald-400 to-emerald-600 overflow-hidden shadow-lg rounded-lg text-white">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-white bg-opacity-30 rounded-md flex items-center justify-center">
              <span class="text-white text-sm">üé´</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-emerald-100 truncate">
                Ticket M√©dio
              </dt>
              <dd class="text-2xl font-bold" data-controller="sensitive-data">
                <span data-sensitive-data-target="content">
                  R$ <%= sprintf('%.2f', @comprehensive_stats&.dig(:average_ticket) || 0) %>
                </span>
              </dd>
              <dt class="text-xs text-emerald-200 mt-1">
                Por aula conclu√≠da
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Classes -->
    <div class="bg-gradient-to-br from-blue-400 to-blue-600 overflow-hidden shadow-lg rounded-lg text-white">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-white bg-opacity-30 rounded-md flex items-center justify-center">
              <span class="text-white text-sm">üìö</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-blue-100 truncate">
                Total de Aulas
              </dt>
              <dd class="text-2xl font-bold">
                <%= @monthly_summary[:classes][:total] %>
              </dd>
              <dt class="text-xs text-blue-200 mt-1">
                <%= @monthly_summary[:classes][:completed] %> conclu√≠das | <%= @monthly_summary[:classes][:scheduled] %> agendadas
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Cancellation Rate -->
    <div class="bg-gradient-to-br from-red-400 to-red-600 overflow-hidden shadow-lg rounded-lg text-white">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-white bg-opacity-30 rounded-md flex items-center justify-center">
              <span class="text-white text-sm">‚ùå</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-red-100 truncate">
                Taxa de Cancelamento
              </dt>
                             <dd class="text-2xl font-bold">
                <%= @comprehensive_stats&.dig(:cancellation_rate) || 0 %>%
              </dd>
              <dt class="text-xs text-red-200 mt-1">
                <%= @comprehensive_stats&.dig(:cancelled) || 0 %> canceladas | <%= @comprehensive_stats&.dig(:no_show) || 0 %> faltas
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Completion Rate -->
    <div class="bg-gradient-to-br from-purple-400 to-purple-600 overflow-hidden shadow-lg rounded-lg text-white">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-8 h-8 bg-white bg-opacity-30 rounded-md flex items-center justify-center">
              <span class="text-white text-sm">‚úÖ</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-purple-100 truncate">
                Taxa de Realiza√ß√£o
              </dt>
                             <dd class="text-2xl font-bold">
                <%= @comprehensive_stats&.dig(:completion_rate) || 0 %>%
              </dd>
              <dt class="text-xs text-purple-200 mt-1">
                Das aulas passadas do m√™s
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Appointment Status Distribution Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìä Distribui√ß√£o de Status</h3>

      <div class="relative h-64">
        <%= pie_chart({
          "Conclu√≠das" => @monthly_summary[:classes][:completed] || 0,
          "Agendadas" => @monthly_summary[:classes][:scheduled] || 0,
          "Canceladas" => @monthly_summary[:classes][:cancelled] || 0,
          "Faltas" => @monthly_summary[:classes][:no_show] || 0
        }, colors: ["#059669", "#6366f1", "#ef4444", "#f59e0b"],
           donut: true,
           legend: "bottom",
           height: "250px") %>
      </div>
    </div>

    <!-- Monthly Trends Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìà Tend√™ncia dos √öltimos 6 Meses</h3>
      <div class="relative h-64">
        <% if @monthly_trends.present? && @monthly_trends.any? %>
          <!-- Debug: <%= @monthly_trends.inspect %> -->
          <%= line_chart @monthly_trends.map { |t| [t[:month_name], t[:completed]] },
              label: "Aulas Conclu√≠das",
              colors: ["#3b82f6"],
              curve: false,
              height: "250px",
              library: {
                backgroundColor: "rgba(59, 130, 246, 0.1)",
                fill: true
              } %>
        <% else %>
          <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
            Dados n√£o dispon√≠veis
          </div>
        <% end %>
      </div>
    </div>

    <!-- Weekly Performance Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìÖ Performance Semanal</h3>
      <div class="relative h-64">
        <% if @weekly_performance.present? && @weekly_performance.any? %>
          <!-- Debug: <%= @weekly_performance.inspect %> -->
          <%= column_chart @weekly_performance.map { |w| [w[:week_label], w[:completed]] },
              label: "Aulas Conclu√≠das",
              colors: ["#059669"],
              height: "250px" %>
        <% else %>
          <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
            Dados n√£o dispon√≠veis
          </div>
        <% end %>
      </div>
    </div>

    <!-- Earnings Trend Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üí∞ Evolu√ß√£o do Faturamento</h3>
      <div class="relative h-64" data-controller="sensitive-data">
        <div data-sensitive-data-target="content">
          <% if @monthly_trends.present? && @monthly_trends.any? %>
            <%= area_chart @monthly_trends.map { |t| [t[:month_name], t[:earnings]] },
                prefix: "R$ ",
                colors: ["#059669"],
                curve: false,
                height: "250px",
                library: {
                  backgroundColor: "rgba(5, 150, 105, 0.1)",
                  fill: true
                } %>
          <% else %>
            <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
              Dados n√£o dispon√≠veis
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Top Customers by Revenue Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üèÜ Top 5 Clientes por Faturamento</h3>
      <div class="relative h-64" data-controller="sensitive-data">
        <div data-sensitive-data-target="content">
          <% top_customers_data = @monthly_summary[:earnings][:by_customer].first(5).to_h %>
          <% if top_customers_data.present? %>
            <%= bar_chart top_customers_data,
                prefix: "R$ ",
                colors: ["#7c3aed"],
                height: "250px" %>
          <% else %>
            <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
              Dados n√£o dispon√≠veis
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Busiest Days Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìÖ Dias da Semana Mais Ocupados</h3>
      <div class="relative h-64">
        <% busiest_days_data = @monthly_summary[:workload][:busiest_days].to_h %>
        <% if busiest_days_data.present? %>
          <%= column_chart busiest_days_data,
              label: "N√∫mero de Aulas",
              colors: ["#f59e0b"],
              height: "250px" %>
        <% else %>
          <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
            Dados n√£o dispon√≠veis
          </div>
        <% end %>
      </div>
    </div>
    <!-- Weekly Revenue Chart -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìä Lucro Semanal do M√™s</h3>
      <div class="relative h-64" data-controller="sensitive-data">
        <div data-sensitive-data-target="content">
          <% if @weekly_revenue.present? && @weekly_revenue.any? %>
            <%= column_chart @weekly_revenue.map { |w| [w[:week_label], w[:revenue]] },
                prefix: "R$ ",
                label: "Lucro Total",
                colors: ["#7c3aed"],
                height: "250px" %>
          <% else %>
            <div class="flex items-center justify-center h-full text-gray-500 dark:text-gray-400">
              Dados n√£o dispon√≠veis
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Cancellation Breakdown Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Cancellation Types Breakdown -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üîÑ Tipos de Cancelamento</h3>
      <div class="space-y-4">
        <div class="flex justify-between items-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-orange-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Pendente Reagendamento</span>
          </div>
          <span class="text-lg font-bold text-orange-600 dark:text-orange-400">
            <%= @monthly_summary[:cancellations][:pending_reschedule] %>
          </span>
        </div>
        
        <div class="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-red-800 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Em Cima da Hora</span>
          </div>
          <span class="text-lg font-bold text-red-800 dark:text-red-300">
            <%= @monthly_summary[:cancellations][:with_revenue] %>
          </span>
        </div>
        
        <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-gray-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Padr√£o</span>
          </div>
          <span class="text-lg font-bold text-gray-600 dark:text-gray-400">
            <%= @monthly_summary[:cancellations][:standard] %>
          </span>
        </div>
      </div>
    </div>
    
    <!-- Revenue from Cancellations -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üí∞ Receita de Cancelamentos</h3>
      <div class="space-y-4" data-controller="sensitive-data">
        <div data-sensitive-data-target="content">
          <div class="text-center p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg">
            <p class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">
              R$ <%= sprintf('%.2f', @monthly_summary[:earnings][:cancellation_revenue]) %>
            </p>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Receita de cancelamentos em cima da hora
            </p>
          </div>
          
          <div class="grid grid-cols-2 gap-4 mt-4">
            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <p class="text-lg font-bold text-blue-600 dark:text-blue-400">
                R$ <%= sprintf('%.2f', @monthly_summary[:earnings][:completed]) %>
              </p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Aulas Conclu√≠das</p>
            </div>
            
            <div class="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
              <p class="text-lg font-bold text-purple-600 dark:text-purple-400">
                R$ <%= sprintf('%.2f', @monthly_summary[:earnings][:total_with_cancellations]) %>
              </p>
              <p class="text-xs text-gray-600 dark:text-gray-400">Total Geral</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Performance Metrics Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
    <!-- Detailed Status Breakdown -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìã Detalhamento de Status</h3>
      <div class="space-y-4">
        <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Conclu√≠das</span>
          </div>
          <span class="text-lg font-bold text-green-600 dark:text-green-400">
            <%= @monthly_summary[:classes][:completed] %>
          </span>
        </div>
        
        <div class="flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Agendadas</span>
          </div>
          <span class="text-lg font-bold text-blue-600 dark:text-blue-400">
            <%= @monthly_summary[:classes][:scheduled] %>
          </span>
        </div>
        
        <div class="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Canceladas</span>
          </div>
          <span class="text-lg font-bold text-red-600 dark:text-red-400">
            <%= @monthly_summary[:classes][:cancelled] %>
          </span>
        </div>
        
        <div class="flex justify-between items-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-orange-500 rounded-full mr-3"></div>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">N√£o Compareceu</span>
          </div>
          <span class="text-lg font-bold text-orange-600 dark:text-orange-400">
            <%= @monthly_summary[:classes][:no_show] %>
          </span>
        </div>
      </div>
    </div>

    <!-- Workload Analysis -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">‚è∞ An√°lise de Carga</h3>
      <div class="space-y-4">
        <div class="text-center p-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg">
          <div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">
            <%= @monthly_summary[:workload][:total_hours] %>h
          </div>
          <div class="text-sm text-indigo-500 dark:text-indigo-300">Total de Horas</div>
        </div>
        
        <div>
          <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">üìà Dias mais ocupados:</h4>
          <% @monthly_summary[:workload][:busiest_days].first(3).each do |day, count| %>
            <div class="flex justify-between items-center mb-2 p-2 bg-gray-50 dark:bg-gray-700 rounded">
              <span class="text-sm text-gray-600 dark:text-gray-400"><%= day %></span>
              <span class="text-sm font-medium text-gray-900 dark:text-gray-100">
                <%= count %> aulas
              </span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sync Status -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üîÑ Status de Sincroniza√ß√£o</h3>
      <div class="space-y-4">
        <div class="text-center">
          <div class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">
            <%= @monthly_summary[:sync_status][:sync_percentage] %>%
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Sincronizado</div>
        </div>
        
        <!-- Progress Ring -->
        <div class="flex justify-center">
          <div class="relative w-24 h-24">
            <svg class="transform -rotate-90 w-24 h-24">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="transparent" 
                     class="text-gray-200 dark:text-gray-700" transform="translate(36, 36)"/>
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="transparent"
                     stroke-dasharray="<%= 2 * Math::PI * 10 %>" 
                     stroke-dashoffset="<%= 2 * Math::PI * 10 * (1 - @monthly_summary[:sync_status][:sync_percentage] / 100.0) %>"
                     class="text-indigo-500" transform="translate(36, 36)"/>
            </svg>
          </div>
        </div>
        
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Sincronizados:</span>
            <span class="font-medium text-green-600 dark:text-green-400">
              <%= @monthly_summary[:sync_status][:synced_appointments] %>
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Pendentes:</span>
            <span class="font-medium text-yellow-600 dark:text-yellow-400">
              <%= @monthly_summary[:sync_status][:pending_sync] %>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Customers Table -->
  <% if @monthly_summary[:earnings][:by_customer].any? %>
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 mb-8">
      <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üèÜ Top 10 Clientes (Faturamento)</h3>
      <div class="overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                Posi√ß√£o
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                Cliente
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                Faturamento
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                Participa√ß√£o
              </th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            <% @monthly_summary[:earnings][:by_customer].each_with_index do |(customer_name, earnings), index| %>
              <tr class="<%= index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20' : '' %>">
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                  <% if index == 0 %>
                    <span class="text-2xl">ü•á</span>
                  <% elsif index == 1 %>
                    <span class="text-2xl">ü•à</span>
                  <% elsif index == 2 %>
                    <span class="text-2xl">ü•â</span>
                  <% else %>
                    <span class="font-medium text-gray-500 dark:text-gray-400"><%= index + 1 %>¬∫</span>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
                  <%= customer_name %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm" data-controller="sensitive-data">
                  <span data-sensitive-data-target="content" class="font-medium text-green-600 dark:text-green-400">
                    R$ <%= earnings %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                  <%= @monthly_summary[:earnings][:completed] > 0 ? ((earnings.to_f / @monthly_summary[:earnings][:completed]) * 100).round(1) : 0 %>%
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <!-- Daily Schedule -->
  <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 mb-8">
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">üìÖ Agenda de Hoje</h3>
    <% if @daily_schedule[:appointments].any? %>
      <div class="space-y-3">
        <% @daily_schedule[:appointments].each do |appointment| %>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-lg border-l-4 
            <% case appointment[:status] %>
            <% when 'completed' %>
              border-green-500
            <% when 'scheduled' %>
              border-blue-500
            <% when 'cancelled' %>
              border-red-500
            <% when 'no_show' %>
              border-orange-500
            <% end %>">
            <div>
              <span class="font-medium text-gray-900 dark:text-gray-100 text-lg">
                <%= appointment[:time] %> - <%= appointment[:customer] %>
              </span>
              <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">
                (<%= appointment[:duration] %>h)
              </span>
            </div>
            <div class="flex items-center space-x-3">
              <span class="px-3 py-1 text-xs rounded-full font-medium
                <% case appointment[:status] %>
                <% when 'scheduled' %>
                  bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
                <% when 'completed' %>
                  bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
                <% when 'cancelled' %>
                  bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
                <% when 'no_show' %>
                  bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200
                <% end %>">
                <%= appointment[:status].humanize %>
              </span>
              <% if appointment[:synced] %>
                <span class="text-green-500 text-lg" title="Sincronizado">‚úì</span>
              <% else %>
                <span class="text-yellow-500 text-lg" title="N√£o sincronizado">‚è≥</span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
      
      <div class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg">
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div class="flex justify-between">
            <span class="text-blue-700 dark:text-blue-300">Total de aulas:</span>
            <span class="font-medium text-blue-900 dark:text-blue-100">
              <%= @daily_schedule[:total_classes] %>
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-blue-700 dark:text-blue-300">Total de horas:</span>
            <span class="font-medium text-blue-900 dark:text-blue-100">
              <%= @daily_schedule[:total_hours] %>h
            </span>
          </div>
        </div>
      </div>
    <% else %>
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üìÖ</div>
        <p class="text-gray-500 dark:text-gray-400 text-lg">
          Nenhum compromisso agendado para hoje.
        </p>
        <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">
          Que tal aproveitar para planejar a semana?
        </p>
      </div>
    <% end %>
  </div>

  <!-- Action Buttons -->
  <div class="flex justify-center space-x-4">
    <%= link_to calendars_path(view_mode: 'appointments'), 
        class: "bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all hover:shadow-xl" do %>
      üìÖ Voltar para Calend√°rio
    <% end %>
    <%= link_to customers_path, 
        class: "bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all hover:shadow-xl" do %>
      üë• Ver Clientes
    <% end %>
    <%= link_to appointments_path, 
        class: "bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all hover:shadow-xl" do %>
      üìã Ver Compromissos
    <% end %>
  </div>
</div>


