<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">
        ☀️ Bom dia!
      </h1>
      <p class="text-gray-600 dark:text-gray-400 mt-1">
        <%= Date.current.strftime("%A, %d de %B de %Y") %>
      </p>
    </div>
    
    <!-- Quick Actions -->
    <div class="flex flex-wrap gap-3 mt-4 sm:mt-0">
      <%= link_to new_appointment_path, 
          class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" do %>
        ➕ Nova Aula
      <% end %>
      <%= link_to calendars_path, 
          class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" do %>
        📅 Agenda
      <% end %>
      <%= link_to daily_completion_calendars_path(date: Date.current), 
          class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" do %>
        ✅ Concluir Hoje
      <% end %>
    </div>
  </div>

  <!-- Key Stats Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Customers -->
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 overflow-hidden shadow-lg rounded-xl text-white">
      <div class="p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
              <span class="text-white text-xl">👥</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-blue-100 truncate">
                Total de Clientes
              </dt>
              <dd class="text-3xl font-bold">
                <%= @customers_count %>
              </dd>
              <dt class="text-xs text-blue-200 mt-1">
                <%= @active_customers %> ativos
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Today's Appointments -->
    <div class="bg-gradient-to-br from-purple-500 to-purple-600 overflow-hidden shadow-lg rounded-xl text-white">
      <div class="p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
              <span class="text-white text-xl">📚</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-purple-100 truncate">
                Aulas de Hoje
              </dt>
              <dd class="text-3xl font-bold">
                <%= @total_appointments_today %>
              </dd>
              <dt class="text-xs text-purple-200 mt-1">
                <%= @completed_appointments_today %> concluídas
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Performance -->
    <div class="bg-gradient-to-br from-green-500 to-green-600 overflow-hidden shadow-lg rounded-xl text-white">
      <div class="p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
              <span class="text-white text-xl">📊</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-green-100 truncate">
                Esta Semana
              </dt>
              <dd class="text-3xl font-bold">
                <%= @weekly_stats[:completed] %>/<%= @weekly_stats[:non_cancelled] %>
              </dd>
              <dt class="text-xs text-green-200 mt-1">
                <%= @weekly_stats[:completion_rate] %>% conclusão real
                <% if @weekly_stats[:cancelled] > 0 %>
                  • <%= @weekly_stats[:cancelled] %> canceladas (<%= @weekly_stats[:cancellation_rate] %>%)
                <% end %>
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Business Health Card -->
    <div class="bg-gradient-to-br from-orange-500 to-orange-600 overflow-hidden shadow-lg rounded-xl text-white">
      <div class="p-6">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <div class="w-10 h-10 bg-white bg-opacity-30 rounded-lg flex items-center justify-center">
              <span class="text-white text-xl">📈</span>
            </div>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-orange-100 truncate">
                Saúde do Negócio
              </dt>
              <dd class="text-3xl font-bold">
                <%= @business_health[:retention_rate] %>%
              </dd>
              <dt class="text-xs text-orange-200 mt-1">
                <% if @business_health[:trending_up] %>
                  📈 Crescimento: +<%= @business_health[:growth_rate] %>%
                <% elsif @business_health[:growth_rate] < 0 %>
                  📉 Variação: <%= @business_health[:growth_rate] %>%
                <% else %>
                  📊 Estável este mês
                <% end %>
              </dt>
            </dl>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Today's Agenda -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
          📅 Agenda de Hoje
        </h3>
        <%= link_to daily_completion_calendars_path(date: @selected_date), 
            class: "text-purple-600 hover:text-purple-700 text-sm font-medium" do %>
          Ver Conclusões →
        <% end %>
      </div>

      <% if @todays_appointments.any? %>
        <div class="space-y-3">
          <% @todays_appointments.each do |appointment| %>
            <div class="flex justify-between items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 rounded-lg border-l-4 
              <% case appointment.status %>
              <% when 'completed' %>
                border-green-500
              <% when 'scheduled' %>
                <% if appointment.customer.credit? %>
                  border-blue-500
                <% else %>
                  border-purple-500
                <% end %>
              <% when 'cancelled' %>
                border-red-500
              <% end %>">
              <div>
                <div class="font-medium text-gray-900 dark:text-gray-100">
                  <%= appointment.scheduled_at.strftime("%H:%M") %> - 
                  <span data-controller="sensitive-data" data-sensitive-data-type-value="general">
                    <span data-sensitive-data-target="content"><%= appointment.customer.name %></span>
                  </span>
                </div>
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  <%= appointment.duration %>h • 
                  <%= appointment.customer.credit? ? "Crédito" : "Assinatura" %>
                </div>
              </div>
              <div class="text-right">
                <span class="px-2 py-1 text-xs rounded-full font-medium
                  <% case appointment.status %>
                  <% when 'scheduled' %>
                    bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200
                  <% when 'completed' %>
                    bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200
                  <% when 'cancelled' %>
                    bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200
                  <% end %>">
                  <%= appointment.status.humanize %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <div class="text-4xl mb-4">🏖️</div>
          <p class="text-gray-500 dark:text-gray-400">
            Nenhuma aula agendada para hoje
          </p>
          <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">
            Que tal aproveitar para organizar a agenda?
          </p>
        </div>
      <% end %>
    </div>

    <!-- Quick Actions & Shortcuts -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6">
        🚀 Ações Rápidas
      </h3>
      
      <div class="grid grid-cols-2 gap-4">
        <%= link_to calendars_path, 
            class: "p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg hover:from-blue-100 hover:to-blue-200 dark:hover:from-blue-800/30 dark:hover:to-blue-700/30 transition-all group" do %>
          <div class="flex flex-col items-center text-center">
            <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">📅</div>
            <div class="text-sm font-medium text-blue-700 dark:text-blue-300">Ver Agenda</div>
          </div>
        <% end %>

        <%= link_to customers_path, 
            class: "p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg hover:from-purple-100 hover:to-purple-200 dark:hover:from-purple-800/30 dark:hover:to-purple-700/30 transition-all group" do %>
          <div class="flex flex-col items-center text-center">
            <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">👥</div>
            <div class="text-sm font-medium text-purple-700 dark:text-purple-300">Clientes</div>
          </div>
        <% end %>

        <%= link_to appointments_path, 
            class: "p-4 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg hover:from-green-100 hover:to-green-200 dark:hover:from-green-800/30 dark:hover:to-green-700/30 transition-all group" do %>
          <div class="flex flex-col items-center text-center">
            <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">📋</div>
            <div class="text-sm font-medium text-green-700 dark:text-green-300">Compromissos</div>
          </div>
        <% end %>

        <%= link_to metrics_calendars_path, 
            class: "p-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg hover:from-orange-100 hover:to-orange-200 dark:hover:from-orange-800/30 dark:hover:to-orange-700/30 transition-all group" do %>
          <div class="flex flex-col items-center text-center">
            <div class="text-2xl mb-2 group-hover:scale-110 transition-transform">📊</div>
            <div class="text-sm font-medium text-orange-700 dark:text-orange-300">Métricas</div>
          </div>
        <% end %>
      </div>

      <!-- Weekly Overview -->
      <div class="mt-6 p-4 bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 rounded-lg">
        <h4 class="text-sm font-medium text-indigo-700 dark:text-indigo-300 mb-3">📈 Resumo da Semana</h4>
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Total:</span>
            <span class="font-medium text-gray-900 dark:text-gray-100"><%= @weekly_stats[:total] %> aulas</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Horas:</span>
            <span class="font-medium text-gray-900 dark:text-gray-100"><%= @weekly_stats[:total_hours] %>h</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Concluídas:</span>
            <span class="font-medium text-green-600 dark:text-green-400"><%= @weekly_stats[:completed] %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Canceladas:</span>
            <span class="font-medium text-red-600 dark:text-red-400"><%= @weekly_stats[:cancelled] %> (<%= @weekly_stats[:cancellation_rate] %>%)</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Conclusão Real:</span>
            <span class="font-medium text-indigo-600 dark:text-indigo-400"><%= @weekly_stats[:completion_rate] %>%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Efetivas:</span>
            <span class="font-medium text-gray-900 dark:text-gray-100"><%= @weekly_stats[:non_cancelled] %> aulas</span>
          </div>
          <% if @weekly_stats[:scheduled] > 0 %>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Agendadas:</span>
            <span class="font-medium text-blue-600 dark:text-blue-400"><%= @weekly_stats[:scheduled] %></span>
          </div>
          <% end %>
        </div>
      </div>

      <!-- Business Health Overview -->
      <div class="mt-6 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-lg">
        <h4 class="text-sm font-medium text-purple-700 dark:text-purple-300 mb-3">💼 Indicadores do Negócio</h4>
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Retenção:</span>
            <span class="font-medium text-purple-600 dark:text-purple-400"><%= @business_health[:retention_rate] %>%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Confiabilidade:</span>
            <span class="font-medium text-green-600 dark:text-green-400"><%= @business_health[:reliability_rate] %>%</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Este Mês:</span>
            <span class="font-medium text-gray-900 dark:text-gray-100"><%= @business_health[:this_month_appointments] %> aulas</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600 dark:text-gray-400">Mês Anterior:</span>
            <span class="font-medium text-gray-600 dark:text-gray-400"><%= @business_health[:last_month_appointments] %> aulas</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Simple Birthday Reminder -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">
        🎂 Aniversários
      </h3>
      
      <% if @todays_birthdays.any? %>
        <div class="mb-4 p-3 bg-gradient-to-r from-pink-50 to-rose-50 dark:from-pink-900/20 dark:to-rose-900/20 rounded-lg border border-pink-200 dark:border-pink-800">
          <div class="font-medium text-pink-800 dark:text-pink-200 text-sm mb-2">🎉 Hoje:</div>
          <% @todays_birthdays.each do |customer| %>
            <div class="text-sm text-gray-900 dark:text-gray-100">
              <span data-controller="sensitive-data" data-sensitive-data-type-value="general">
                <span data-sensitive-data-target="content"><%= customer.name %></span>
              </span>
              <% if customer.age %>
                (<%= customer.age %> anos)
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <% if @this_month_birthdays.any? %>
        <div class="text-sm">
          <div class="font-medium text-gray-700 dark:text-gray-300 mb-2">Este mês:</div>
          <div class="space-y-1 max-h-32 overflow-y-auto">
            <% @this_month_birthdays.first(10).each do |customer| %>
              <div class="text-gray-600 dark:text-gray-400 text-xs">
                <%= customer.birthdate.day %>/<%= customer.birthdate.month %> - 
                <span data-controller="sensitive-data" data-sensitive-data-type-value="general">
                  <span data-sensitive-data-target="content"><%= customer.name.split(' ').first %></span>
                </span>
                <% if customer.birthday_today? %>
                  🎂
                <% end %>
                <% unless customer.active? %>
                  <span class="text-gray-400">💤</span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="text-center py-4">
          <div class="text-gray-500 dark:text-gray-400 text-sm">
            📅 Nenhum aniversário este mês
          </div>
        </div>
      <% end %>
    </div>

    <!-- Upcoming Appointments -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">
        ⏰ Próximas Aulas
      </h3>
      
      <% if @upcoming_appointments.any? %>
        <div class="space-y-3">
          <% @upcoming_appointments.each do |appointment| %>
            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div>
                <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                  <%= appointment.customer.name %>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  <%= appointment.scheduled_at.strftime("%d/%m %H:%M") %>
                </div>
              </div>
              <div class="text-xs text-gray-600 dark:text-gray-400">
                <%= appointment.duration %>h
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 dark:text-gray-400 text-sm text-center py-4">
          Nenhuma aula próxima agendada
        </p>
      <% end %>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">
        ✅ Recém Concluídas
      </h3>
      
      <% if @recent_completed.any? %>
        <div class="space-y-3">
          <% @recent_completed.each do |appointment| %>
            <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
              <div>
                <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                  <%= appointment.customer.name %>
                </div>
                <div class="text-xs text-green-600 dark:text-green-400">
                  <%= appointment.completed_at&.strftime("%d/%m %H:%M") %>
                </div>
              </div>
              <div class="text-xs text-green-600 dark:text-green-400">
                <%= appointment.duration %>h
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 dark:text-gray-400 text-sm text-center py-4">
          Nenhuma aula concluída recentemente
        </p>
      <% end %>
    </div>

    <!-- Low Credit Warnings -->
    <div class="bg-white dark:bg-gray-800 shadow-lg rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">
        ⚠️ Créditos Baixos
      </h3>
      
      <% if @low_credit_customers.any? %>
        <div class="space-y-3">
          <% @low_credit_customers.each do |customer| %>
            <div class="p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
              <div class="flex justify-between items-center">
                <div>
                  <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                    <%= customer.name %>
                  </div>
                  <div class="text-xs text-yellow-700 dark:text-yellow-300">
                    <%= customer.total_remaining_hours %>h restantes
                  </div>
                </div>
                <%= link_to customer_path(customer), 
                    class: "text-yellow-600 hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300" do %>
                  <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        
        <div class="mt-4">
          <%= link_to customer_credits_path, 
              class: "text-xs text-yellow-600 hover:text-yellow-700 dark:text-yellow-400 dark:hover:text-yellow-300 font-medium" do %>
            Ver todos os créditos →
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 dark:text-gray-400 text-sm text-center py-4">
          Todos os clientes com créditos OK! ✨
        </p>
      <% end %>
    </div>
  </div>
</div>